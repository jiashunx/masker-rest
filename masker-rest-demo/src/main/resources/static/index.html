<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>测试页面01</title>
</head>
<body>
    <div>
        <label>文件上传测试（基于FormData，单选）</label>
        <br>
        <input type="file" id="file-upload0" name="avatar">
        <button type="button" id="btn-file-upload0">保存</button>
    </div>
    <div>
        <label>文件上传测试（基于form表单，多选）</label>
        <br>
        <form id="file-upload-form1">
            <input type="file" id="file" name="file-upload1" multiple="multiple">
        </form>
        <button type="button" id="btn-file-upload1">保存</button>
    </div>
    <div>
        <label>文件下载测试（下载项目README.md文件）</label>
        <br>
        <button type="button" id="btn-download-test0">下载</button>
    </div>
    <div>
        <button type="button" id="btn-websocket-test">WebSocket测试</button>
    </div>
    <script type="text/javascript" src="./webjars/webjar-jquery/3.5.1/dist/jquery.min.js"></script>
    <script>
        $("#btn-file-upload0").click(function () {
            var files = $('#file-upload0').prop('files');
            var formData = new FormData();
            formData.append('avatar', files[0]);
            $.ajax({
                url: './fileupload/test0',
                type: 'POST',
                data: formData,
                cache: false,
                processData: false,
                contentType: false
            });
        });
        $("#btn-file-upload1").click(function () {
            var formData = new FormData($("#file-upload-form1")[0]);
            $.ajax({
                url: './fileupload/test1',
                type: 'POST',
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log("upload files success.", data);
                }
            });
        });
        $("#btn-download-test0").click(function () {
            var _win = window.open("about:blank");
            _win.location.href = "./filedownload/test0";
        });
        if (window.WebSocket) {
            let _socket = new WebSocket("ws://localhost:21700/demo000");
            _socket.onmessage = function (ev) {
                console.log("receive from server: ", ev.data);
            };
            _socket.onopen = function (ev) {
                console.log("connected to server");
            };
            _socket.onclose = function (ev) {
                console.log("disconnected from server");
            };
            $("#btn-websocket-test").click(function () {
                if (_socket.readyState === WebSocket.OPEN) {
                    _socket.send("hahahhahahhhhhh");
                } else {
                    alert("WebSocket Connection is not ready.");
                }
            });
        }
    </script>
</body>
</html>
